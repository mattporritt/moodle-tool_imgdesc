define("tool_imgdesc/describe",["exports","core/ajax","core/str"],(function(_exports,_ajax,Str){var obj;
/**
   * Image description UI helpers (generate/regenerate + feedback).
   *
   * @module     tool_imgdesc/describe
   * @copyright  Matt Porritt <matt.porritt@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.generate=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj},Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str);const toggleFooterButtons=(uniqid,show)=>{const footer=document.getElementById("".concat(uniqid,"-footer"));footer&&(show?footer.classList.remove("d-none"):footer.classList.add("d-none"))},showLoading=async target=>{target.setAttribute("aria-busy","true"),target.setAttribute("aria-live","polite"),target.classList.add("bg-light");const label=await Str.get_string("generating","tool_imgdesc");target.innerHTML='\n        <div class="d-flex align-items-center gap-2">\n            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n            <span>'.concat(label,"</span>\n        </div>\n    ")},renderDescription=(target,description)=>{target.removeAttribute("aria-busy"),target.classList.remove("bg-light");const escaped=document.createElement("div");escaped.textContent=(null!=description?description:"").toString(),target.innerHTML='<div class="text-body">'.concat(escaped.innerHTML.replace(/\n/g,"<br>"),"</div>")},generate=async(textboxId,contextid,itemid,uniqid)=>{const requestobj={methodname:"tool_imgdesc_describe_image",args:{contextid:contextid,itemid:itemid}},textarea=document.getElementById(textboxId);await showLoading(textarea);try{const responseObj=await _ajax.default.call([requestobj])[0];var _responseObj$generate;if(responseObj&&responseObj.error)renderDescription(textarea,responseObj.error);else renderDescription(textarea,null!==(_responseObj$generate=null==responseObj?void 0:responseObj.generatedcontent)&&void 0!==_responseObj$generate?_responseObj$generate:"")}catch(error){var _ref,_error$message;renderDescription(textarea,null===(_ref=null!==(_error$message=null==error?void 0:error.message)&&void 0!==_error$message?_error$message:error)||void 0===_ref?void 0:_ref.toString())}toggleFooterButtons(uniqid,!0)};_exports.generate=generate;_exports.init=(textboxId,contextid,itemid,uniqid)=>(((uniqid,textboxId,contextid,itemid)=>{const regen=document.getElementById("".concat(uniqid,"-btn-regenerate")),reset=document.getElementById("".concat(uniqid,"-btn-newimage"));regen&&regen.addEventListener("click",(async e=>{e.preventDefault(),toggleFooterButtons(uniqid,!1);const textarea=document.getElementById(textboxId);await showLoading(textarea),await generate(textboxId,contextid,itemid,uniqid)})),reset&&reset.addEventListener("click",(e=>{e.preventDefault(),window.location.href=window.location.pathname+window.location.search}))})(uniqid,textboxId,contextid,itemid),generate(textboxId,contextid,itemid,uniqid))}));

//# sourceMappingURL=describe.min.js.map